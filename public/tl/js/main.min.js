/*! favor 0.0.1 2013-07-14 09:08:32 */
!function(a,b,c){window.tl=window.tl||{};var d=function(){};console=console||{log:d,info:d,warn:d,debug:d,error:d},_apply=function(a,b){for(var c in b)a[c]||(a[c]=b[c])};var e=["templates"],f=window.tl.spa=b.Router.extend({defaults:function(){return{models:{},views:{},templates:[],root:"/"}},initialize:function(b){this.tm=new i,_apply(this,this.defaults()),_apply(this,a.pick(b,e)),this.configure.apply(this,arguments)},configure:function(){},startup:function(){var a=this;a.navigate(),b.history.start({pushState:!0,hashChange:!0})},shutdown:function(){},navigate:function(){var a=this;c(document).on("click","a[href]:not([data-bypass])",function(b){var d={prop:c(this).prop("href"),attr:c(this).attr("href")},e=location.protocol+"//"+location.host+a.root;d.prop.slice(0,e.length)===e&&(b.preventDefault(),Backbone.history.navigate(d.attr,!0))})}});f.Model=b.Model.extend({}),f.Collection=b.Collection.extend({initialize:function(){this.cid=a.uniqueId("c"),this.configure.apply(this,arguments)},configure:function(){}});var g=["spa","hidden","modelDriven","prerendered","templateName","vid"],h=f.View=b.View.extend({defaults:function(){return{spa:null,children:{},parent:null,hidden:!1,modelDriven:!0,prerendered:!0,rendered:!1,templateName:"",template:null,vid:""}},initialize:function(b){_apply(this,this.defaults()),_apply(this,a.pick(b,g)),this.configure.apply(this,arguments),this.prerendered&&this.doRender()},configure:function(){},getId:function(){return this.vid},getParent:function(){return this.parent},setParent:function(a){return this.parent=a,this},getChild:function(a){return this.children[a]},getChildren:function(){return this.children},addChild:function(a){return this.children[a.getId()]=a,a.setParent(this),this},removeChild:function(a){return this.children[a]&&(this.children[a].setParent(null),this.children[a]=null,delete this.children[a]),this},render:function(){return this.rendered||this.doRender(),this},doRender:function(){this.ensureTemplate();var b=a.result(this,"model"),d={};return b.toJSON&&(d=b.toJSON()),c(this.el).html(this.template({input:d,id:this.getId()})),this.rendered=!0,this.hidden?this.hide():this.show(),this.renderChildren(),this},ensureTemplate:function(){this.template||(this.template=this.spa.tm.get(this.templateName))},renderChildren:function(){a.each(this.children,function(a,b){this.$('[data-view-id="'+b+'"]').replaceWith(a.el)},this)},show:function(){return this.$el.show(),this.hidden=!1,this},hide:function(){return this.$el.hide(),this.hidden=!0,this},isRendered:function(){return this.rendered},isHidden:function(){return this.hidden}});h.extend=b.View.extend;var i=window.tl.spa.TemplateManager=function(b){this.templates={},this.o={},b&&(a.extend(this.o,b),a.extend(this,a.pick(this.o,"prefix"))),a.extend(this.templates,window.JST)};a.extend(i.prototype,{prefix:"templates",templates:{},loadTemplates:function(a,b){var d=this,e=function(f){var g=a[f];console.log("Loading view template: "+g),c.get(d.prefix+"/"+g+".html",function(c){d.templates[g]=c,f++,f<a.length?e(f):b()})};e(0)},get:function(a){return this.templates[a]}})}(_,Backbone,jQuery);var tl=window.tl,Product=tl.spa.Model.extend({urlRoot:"product"}),NewestCatalog=tl.spa.Collection.extend({model:Product,url:"public/dummy/newest.js"}),HottestCatalog=tl.spa.Collection.extend({model:Product,url:"public/dummy/hottest.js"}),SelfrunCatalog=tl.spa.Collection.extend({model:Product,url:"public/dummy/selfrun.js"}),CatalogView=tl.spa.View.extend({templateName:"catalog",hidden:!1,prerendered:!0,events:{'mouseup [href="catalog-newest"]':"catalogNewest",'mouseup [href="catalog-hottest"]':"catalogHottest",'mouseup [href="catalog-selfrun"]':"catalogSelfrun"},configure:function(){this.newestLargeIconsView=new CatalogListLargeIconsView({vid:"catalog-newest",spa:this.spa,prerendered:!0,model:this.model.newest}),this.hottestLargeIconsView=new CatalogListLargeIconsView({vid:"catalog-hottest",spa:this.spa,prerendered:!0,model:this.model.hottest}),this.selfrunLargeIconsView=new CatalogListLargeIconsView({vid:"catalog-selfrun",spa:this.spa,prerendered:!0,model:this.model.selfrun}),this.addChild(this.newestLargeIconsView),this.addChild(this.hottestLargeIconsView),this.addChild(this.selfrunLargeIconsView)},switchView:function(a){_.each(this.children,function(a){a.hide()}),a.doRender(),a.show()},catalogNewest:function(){this.switchView(this.newestLargeIconsView)},catalogHottest:function(){this.switchView(this.hottestLargeIconsView)},catalogSelfrun:function(){this.switchView(this.selfrunLargeIconsView)}}),Favor=tl.spa.extend({routes:{"catalog-newest":"catalogNewest","catalog-hottest":"catalogHottest","catalog-selfrun":"catalogSelfrun","*view(/:id)":"switchView",home:"home",share:"share",find:"find",forum:"forum",about:"about"},root:"/",defaultUri:"home",configure:function(){this.models.catalog={fetched:!0,newest:null,hottest:null,selfrun:null};var a=new NewestCatalog({});a.fetch(function(){a.fetched=!0}),this.models.catalog.newest=a;var b=new HottestCatalog({});b.fetch(function(){b.fetched=!0}),this.models.catalog.hottest=b;var c=new SelfrunCatalog({});c.fetch(function(){c.fetched=!0}),this.models.catalog.selfrun=c},switchView:function(a,b){console.log(a+" - "+b);var c="",d=null;if(this.routes[a]?c=a:null==a?c=this.defaultUri:console.warn("/"+a+"/"+(b?b:" is not valid URI")),c){console.log("viewName - "+c);var d=this.routes[c];-1==c.indexOf("-")&&this[d](d,b),$("li>a[set]").parent().removeClass("active"),$('li>a[set="'+c+'"]').parent().addClass("active"),$(".view").hide(),$('[set="'+c+'"].view').show()}},home:function(){},share:function(a){var b=this.views[a];if(!b){b=new ShareSubjectView({spa:this,model:{},modelDriven:!1}),this.views[a]=b;var c='[set="'+a+'"].view';$(c).html(b.el)}$("#imageFile").fileupload({url:"/files/",dataType:"json",add:function(a,b){$("#fileName").html(b.files[0].name),b.submit()},done:function(a,b){$("#previewImg").attr("src","/files/"+b.files[0].name)}}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled"),$("#productLink").bind("change",function(){var a=$("#productLink").val();a.length>0?$("#previewLink").attr("href","javascript: window.open('"+a+"');"):$("#previewLink").attr("href","/share")}).change(),$("#shortDes").bind("change keyup",function(){$("#previewSDes").html($("#shortDes").val())}).change(),$("#longDes").bind("change keyup",function(){$("#previewLDes").html($("#longDes").val())}).change(),$("#saveImageLink").bind("click",function(){var a=$("#imageLink").val();a.length>0&&($("#fileName").html($("#imageLink").val()),$("#previewImg").attr("src",$("#imageLink").val()),$("#myModal").modal("hide"))}).click()},find:function(a){this.ensureCatalogView(a).show().catalogHottest(!0)},catalogNewest:function(){if(this.models.catalog.newest.fetched)this.switchView("find"),this.ensureCatalogView("find").show().catalogNewest();else{var a=this;this.models.catalog.newest.fetch({success:function(){a.models.catalog.newest.fetched=!0,a.switchView("find"),a.ensureCatalogView("find").show().catalogNewest()}})}},catalogHottest:function(){if(this.models.catalog.hottest.fetched)this.switchView("find"),this.ensureCatalogView("find").show().catalogHottest();else{var a=this;this.models.catalog.hottest.fetch({success:function(){a.models.catalog.hottest.fetched=!0,a.switchView("find"),a.ensureCatalogView("find").show().catalogHottest()}})}},catalogSelfrun:function(){if(this.models.catalog.selfrun.fetched)this.switchView("find"),this.ensureCatalogView("find").show().catalogSelfrun();else{var a=this;this.models.catalog.selfrun.fetch({success:function(){a.models.catalog.selfrun.fetched=!0,a.switchView("find"),a.ensureCatalogView("find").show().catalogSelfrun()}})}},forum:function(){},about:function(){},ensureCatalogView:function(a){var b=this.views.catalog;if(!b){b=new CatalogView({spa:this,model:this.models.catalog,modelDriven:!1}),this.views.catalog=b;var c='[set="'+a+'"].view';$(c).html(b.el)}return b}}),favor=null,CatalogListLargeIconsView=tl.spa.View.extend({templateName:"large-icons"}),ShareSubjectView=tl.spa.View.extend({templateName:"share-subject"});$(document).ready(function(){favor=new Favor({}),favor.startup()});
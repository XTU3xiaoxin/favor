/*! favor 0.0.1 2013-07-11 09:32:03 */
!function(a){a.ajaxSetup({error:function(a,b,c){alert(b),alert(c),alert(a.responseText)}})}(jQuery);var TemplateManager=function(a){this.templates={},this.o={},a&&(_.extend(this.o,a),_.extend(this,_.pick(this.o,"prefix")))};_.extend(TemplateManager.prototype,{prefix:"templates",templates:{},loadTemplates:function(a,b){var c=this,d=function(e){var f=a[e];console.log("Loading view template: "+f),$.get(c.prefix+"/"+f+".html",function(g){c.templates[f]=g,e++,e<a.length?d(e):b()})};d(0)},get:function(a){return this.templates[a]}});var tpl={templates:{},loadTemplates:function(a,b){var c=this,d=function(e){var f=a[e];console.log("Loading template: "+f),$.get("templates/"+f+".html",function(g){c.templates[f]=g,e++,e<a.length?d(e):b()})};d(0)},get:function(a){return this.templates[a]}},tm=new TemplateManager,LargeIconsView=Backbone.View.extend({templateName:"large-icons",events:{"change #newest":"goNewest","change #hottest":"goHottest","change #selfrun":"goSelfrun"},initialize:function(){},render:function(){return this.template||(this.template=_.template(tm.get(this.templateName))),$(this.el).html(this.template(this.model)),this},goNewest:function(){},goHottest:function(){},selfrun:function(){}}),MediumIconsView=Backbone.View.extend({templateName:"medium-icons",events:{"change #newest":"goNewest","change #hottest":"goHottest","change #selfrun":"goSelfrun"},initialize:function(){},render:function(){return this.template||(this.template=_.template(tm.get(this.templateName))),$(this.el).html(this.template(this.model)),this},goNewest:function(){},goHottest:function(){},selfrun:function(){}}),Workspace=Backbone.Router.extend({routes:{"catalog-newest":"catalogNewest","catalog-hottest":"catalogHottest","catalog-selfrun":"catalogSelfrun","*view(/:id)":"switchView",home:"home",share:"share",find:"find",forum:"forum",about:"about"},views:{},root:"/",defaultUri:"home",switchView:function(a,b){console.log(a+" - "+b);var c="",d=null;if(this.routes[a]?c=a:null==a?c=this.defaultUri:console.warn("/"+a+"/"+(b?b:" is not valid URI")),c){console.log("viewName - "+c);var d=this.routes[c];-1==c.indexOf("-")&&this[d](d,b),console.log("viewAction - "+this[d]),$("li>a[set]").parent().removeClass("active"),$('li>a[set="'+c+'"]').parent().addClass("active"),$(".view").hide(),$('[set="'+c+'"].view').show()}},home:function(){},share:function(){},find:function(a){$.getJSON("public/dummy/newest.js",{},function(b){view=new LargeIconsView({model:{list:b}});var c='[set="'+a+'"].view .content';$(c).html(view.render().el)})},catalogNewest:function(a){a="find",this.switchView(a),$.getJSON("public/dummy/newest.js",{},function(b){var c=b;view=new LargeIconsView({model:{list:c}});var d='[set="'+a+'"].view .content';$(d).html(view.render().$el.html())})},catalogHottest:function(a){a="find",this.switchView(a),$.getJSON("public/dummy/hottest.js",{},function(b){view=new LargeIconsView({model:{list:b}});var c='[set="'+a+'"].view .content';$(c).html(view.render().el)})},catalogSelfrun:function(a){a="find",this.switchView(a),$.getJSON("public/dummy/selfrun.js",{},function(b){view=new LargeIconsView({model:{list:b}});var c='[set="'+a+'"].view .content';$(c).html(view.render().el)})},forum:function(){},about:function(){}});$(document).ready(function(){var a=null;tm.loadTemplates(["large-icons","medium-icons","list-items"],function(){a=new Workspace,Backbone.history.start({pushState:!0,hashChange:!0})}),$(document).on("click","a[href]:not([data-bypass])",function(b){var c={prop:$(this).prop("href"),attr:$(this).attr("href")},d=location.protocol+"//"+location.host+a.root;c.prop.slice(0,d.length)===d&&(b.preventDefault(),Backbone.history.navigate(c.attr,!0))})});